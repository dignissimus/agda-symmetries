\section{Sorting}
\label{sec:sorting}

Now consider the canonical map $q : \LL(A) \to \MM(A)$ given by $\ext{\eta_A}$. $q$ would be a surjective
function which "forgets" the order on a free monoid and turns it into a free commutative monoid.
The axiom of choice says every surjection $f$ has a section $s$ such that $\forall x.\, f(s(x)) = x$.

\begin{figure}[H]
    \centering
    \scalebox{1.3}{
        % https://q.uiver.app/#q=WzAsMixbMCwwLCJcXExMKEEpIl0sWzMsMCwiXFxNTShBKSJdLFsxLDAsInMiLDAseyJjdXJ2ZSI6LTF9XSxbMCwxLCJxIiwwLHsiY3VydmUiOi0xfV1d
    \begin{tikzcd}[ampersand replacement=\&,cramped]
    	{\LL(A)} \&\&\& {\MM(A)}
    	\arrow["s", curve={height=-6pt}, from=1-4, to=1-1]
    	\arrow["q", curve={height=-6pt}, two heads, from=1-1, to=1-4]
    \end{tikzcd}
    }
    \caption{Relationship of $\LL(A)$ and $\MM(A)$}
    \label{fig:enter-label}
\end{figure}

Since free commutative monoid is the quotient of free monoid by a permutation relation
(which we have proven in~\ref{cmon:qfreemon}), a section $s$ to $q$ would pick a canonical representation
out of the equivalence class generated by permutation.
Using $\SList$ as an example, $s(x :: y :: xs) = s(y :: x :: xs)$ for any $x, y : A$ and $xs : \SList(A)$,
and since it must also respect $\forall xs.\,q(s(xs)) = xs$, $s$ must preserve all content of $xs$,
in other words, it cannot be a trivial function such as $\lambda\,xs. []$.
$s$ must therefore
somehow impose an order on $A$ such that it can be invariant to permutations, turning an unordered list of $A$
into an ordered list of $A$. Axiom of choice giving us a section $s$ to $q$ "for free" is analagous to how
AC implies the well-ordering theorem, which states every set can be well-ordered. However, we want to study
how constructively such as a section can be defined, and the implications of its existence on how $A$
can be ordered or sorted.

We can now study sort functions as sections and their relationship with total orders.
First, we recall the axioms of total order are:
\begin{itemize}
    \item reflexivity: $x \leq x$
    \item transitivity: if $x \leq y$ and $y \leq z$, then $x \leq z$
    \item antisymmetry: if $x \leq y$ and $y \leq x$, then $x = y$
    \item totality: forall $x$ and $y$, we have merely either $x \leq y$ or $y \leq x$ 
\end{itemize}

In the context of this paper, we also want to make a distinction between "decidable total order"
and just "total order". A decidable total order should also satisfy
\begin{itemize}
    \item decidability: forall $x$ and $y$, we have either $x \leq y$ or $\neg(x \leq y)$ 
\end{itemize}

This is a stronger version of the totality axiom, where with totality we have 
either $x \leq y$ or $y \leq x$ merely as a proposition, but decidability allows us to actually
compute if $x \leq y$ is true.

\begin{proposition}
Assume there is a decidable total order on $A$. There is a sort function $s: \MM(A) \to \LL(A)$
which constructs a section to $q : \LL(A) \twoheadrightarrow \MM(A)$
\end{proposition}

\begin{proof}
We can easily construct such a section by any sorting algorithm. In our formalization we chose
insertion sort $\SList(A) \to \List(A)$ due to its inductive properties and simple definition.
However, if we want to define other sorting algorithms, e.g. merge-sort,
other representations such as $\Bag \to \Array$ would be more suitable as we have explained in~\ref{bag:rep}.
It is easy to see how this
proposition holds: $q(s(xs))$ orders an unordered list $xs$ by $s$, and re-discard the order again by
$q$, the act of imposing then forgetting an order on $xs$ does nothing, therefore $q(s(xs)) = xs$ holds.
\end{proof}


\subsection{Order from section}
At this point one may ask if we can construct a section from order, can we construct an order from section?
Indeed, just by the virtue of $s$ being a section, we can almost construct a relation that satisfies
all axioms of total order except transitivity.
We use $\{x,y,\dots\}$ to denote $\eta_A(x) \otimes \eta_A(y) \otimes \dots : \MM(A)$,
and $[x, y, \dots]$ to denote $\eta_A(x) \otimes \eta_A(y) \otimes \dots : \LL(A)$,
or $x :: xs$ to denote $\eta_A(x) \otimes xs : \LL(A)$.

\begin{definition}
Given a section $s$, we define $\term{least}(xs) := \term{head}(s(xs))$.
Further, we define $x \preccurlyeq y := \term{least}(\{x, y\}) = x$. 
\end{definition}

Conceptually, $\term{least}$ sorts $xs$ by $s$, and pick the first element of the sorted list.
With this we can prove the following properties of $\preccurlyeq$.

\begin{proposition}
    $\preccurlyeq$ is decidable iff $A$ has decidable equality.
\end{proposition}

\begin{proposition}
$\preccurlyeq$ is reflexive, antisymmetric, and total.
\end{proposition}
\begin{proof}
For all $x$, $\term{least}(\{x, x\})$ must be $x$, therefore $x \preccurlyeq x$, giving reflexivity.
For all $x$ and $y$, given $x \preccurlyeq y$ and $y \preccurlyeq x$,
we have $\term{least}(\{x, y\}) = x$ and $\term{least}(\{y, x\}) = y$.
Since $\{x, y\} = \{y, x\}$, $\term{least}(\{x, y\}) = \term{least}(\{y, x\})$,
therefore we have $x = y$, giving antisymmetry.
For all $x$ and $y$, $\term{least}(\{x, y\})$ is merely either $x$ or $y$,
therefore we have merely either $x \preccurlyeq y$ or $y \preccurlyeq x$, giving totality.
\end{proof}

\begin{proposition}
$\preccurlyeq$ is not necessarily transitive.
\end{proposition}
\begin{proof}
We give a counter-example of $s$ that would violate transitivity.
Consider this section $s : \SList(\Nat) \to \List(\Nat)$, we can define a sort function
$\term{sort} : \SList(\Nat) \to \List(\Nat)$ which sorts $\SList(\Nat)$ ascendingly. We can use $\term{sort}$
to construct $s$.
\begin{align*}
    s(xs) &= \begin{cases}
        \term{sort}(xs) & \text{if $\term{length}(xs)$ is odd} \\        
        \term{reverse}(\term{sort}(xs)) & \text{otherwise}
    \end{cases}\\
    s([2,3,1,4]) &= [4,3,2,1]\\
    s([2,3,1]) &= [1,2,3]
\end{align*}
\end{proof}

As we can see, we need more constraint on $s$ to prove $\preccurlyeq$ is transitive.
We first define a notion of a sorted list:
\begin{definition}
    Given a list $xs : \LL(A)$, we say $xs$ is sorted by s $\issorted(xs)$ if there merely exists
    a $ys : \MM(A)$ such that $s(ys) = xs$.
\end{definition}

\begin{proposition}\label{sort:sort-to-order}
    $x \preccurlyeq y$ iff $\issorted([x, y])$.
\end{proposition}

\begin{proposition}
    If $A$ has a total order $\leq$, insertion sort $\MM(A) \to \LL(A)$ defined with $\leq$
    satisfies $\isheadleast$.
\end{proposition}

\noindent
We then introduce our first axiom of sorting:
\begin{definition}\label{sort:head-least}
    A section $s$ to $q$ satisfies $\isheadleast$ iff
    $\forall x\, y\, xs.\, \issorted(x :: xs) \land y \in (x :: xs) \to \issorted([x,y])$.
\end{definition}
Here we use the definition of $\in$ from~\ref{comb:member}. Informally, this states if
$x$ is the smallest element of a sorted list $ys$, then for any element $y \in ys$,
$[x, y]$ should be a sorted list. This ensures that $s$ would correctly sort 2-element lists.

\begin{proposition}
    Assuming $s$ satisfies $\isheadleast$, $\preccurlyeq$ is transitive.
\end{proposition}
\begin{proof}
    We use a weaker version of the axiom where $x :: xs$ is fixed to have length of 3.
    We are given $x \preccurlyeq y$ and $y \preccurlyeq z$, we want to show $x \preccurlyeq z$.
    Consider the 3-element $\{x,y,z\} : \MM(A)$. Let $u$ be $\term{least}(\{x,y,z\})$,
    by~\ref{sort:head-least} and~\ref{sort:sort-to-order},
    we have $u \preccurlyeq x \land u \preccurlyeq y \land u \preccurlyeq z$.
    Since $u \in \{x,y,z\}$, $u$ must be one of the element. We prove transitivity by case splitting.
    If $u = x$ we have $x \preccurlyeq z$. If $u = y$ we have $y \preccurlyeq x$, and since
    $x \preccurlyeq y$ and $y \preccurlyeq z$ by assumption,
    we have $x = y$ by antisymmetry and then we have $x \preccurlyeq z$ by substitution.
    Finally, if $u = z$, we have $z \preccurlyeq y$, and since
    $y \preccurlyeq z$ and $x \preccurlyeq y$ by assumption,
    we have $z = y$ by antisymmetry and then we have $x \preccurlyeq z$ by substitution.
\end{proof}

We have shown that a section $s$ that satisfies $\isheadleast$ would imply a total order
$x \preccurlyeq y := \term{least}(\{x, y\}) = x$,
and a total order $\leq$ would imply a section that satisfies $\isheadleast$ which can
be constructed by insertion sort by $\leq$. Now, can we construct a full equivalence
between sections $\MM(A) \to \LL(A)$ that satisfy $\isheadleast$ and total orders on $A$?

\begin{proposition}
    Assume $A$ has a decidable total order $\leq$, we can construct a section $s$ that
    satisfies $\isheadleast$, such that $\preccurlyeq$ constructed from $s$ is equivalent
    to $\leq$.
\end{proposition}

\begin{proof}
    Let $\term{sort} : \MM(A) \to \LL(A)$ be insertion sort defined on $A$ by $\leq$.
    We define $\term{sort}$ to be our section $s$ which satisfy $\isheadleast$.
    It is trivial to see $\term{is-sorted}_{\term{sort}}([x, y])$ iff $x \leq y$ by the definition
    of insertion sort. By 
\end{proof}

\vc{Case study: we test these axioms on a few sorting algorithms.}